---
date: 2026-02-16
topic: "News Hub AI 助手（高控制权限）"
status: draft
---

# News Hub AI 助手设计文档

## Problem Statement

我们要为 News Hub 增加一个深度集成的 AI 助手，让系统从“可用的新闻聚合器”升级为“可理解、可决策、可扩展”的智能助手。

当前核心痛点如下：

- 搜索结果可检索但不够“可理解”，用户仍需手动阅读大量内容。
- 自动打标依赖关键词规则，维护成本高，语义泛化能力弱。
- 新闻源扩展主要靠手动配置，发现新源效率低。
- 外部搜索补充与内部索引检索之间缺少统一策略。

本阶段目标是先定义产品与架构设计，不直接改动现有业务逻辑。

## Constraints

设计必须遵守以下约束：

- 用户隔离是硬约束，所有数据流都必须保持按 `user_id` 隔离。
- 现有新闻模型与来源模型强绑定，新闻入库需具备 `source_id`。
- 后端是异步链路（FastAPI + Motor + Async ES），新增能力不能破坏主采集链路稳定性。
- 现有搜索是 BM25 + 向量混合检索，短期不替换 ES，仅在其上增强体验层。
- 对外部搜索内容需要可追踪来源与可治理策略，不能“黑盒混入”主数据。

## Approach

### Chosen Approach

采用“**在现有服务层上方增加 AI 编排层**”的方案，而不是重写检索或采集底座。

本轮纳入 4 个能力域：

- **AI 总结能力**：单篇摘要、搜索结果聚合总结、定期简报。
- **AI 自动分类**：按主题大类自动分类，并允许 AI 补充新标签。
- **AI 发现好源**：用户给出方向，AI 执行外部发现与推荐。
- **增强搜索**：自然语言理解 + 外部搜索补充 + 结果总结。

### Alternatives Considered

- 方案一：直接以“全自动 Agent”接管全部流程。已放弃，安全与可控性不足。
- 方案二：替换 ES 或重建检索底座。已放弃，投入大且短期收益不高。
- 方案三：解耦新闻与来源模型（取消必填 `source_id`）。暂不采用，改动面过大。

### Key Decision

外部搜索结果采用“**虚拟源入库**”策略，即新增受控来源类型承载外部结果，保持现有数据模型兼容性与可追踪性。

## Architecture

整体架构保持“Collect -> Dedup -> Tag -> Store -> Index”主链路不变，在其周围新增 AI 增强层：

- **Assistant Gateway**：统一入口，接收自然语言任务与系统级请求。
- **Intent & Policy Layer**：意图解析、权限边界判断、可执行策略决策。
- **AI Capability Layer**：总结、分类、源发现、搜索增强四大能力引擎。
- **Integration Layer**：对接现有 sources/news/search/tags 服务，不直接绕过业务约束。
- **Governance Layer**：审计、失败回退、质量评估、可观测性。

该架构强调“AI 负责理解与决策，现有服务负责执行与持久化”。

## Components

### 1) Summary Engine

- 生成单篇新闻摘要。
- 对检索结果做主题聚合与要点提炼。
- 支持生成每日/每周简报。

### 2) Classification Engine

- 基于主题体系做自动分类。
- 在主题体系基础上补充候选标签。
- 输出结构化标签并落库到现有 `tags` 字段。

### 3) Search Augmentation Engine

- 解析自然语言搜索意图。
- 编排内部混合检索与外部搜索补充。
- 执行去重、融合排序、最终摘要生成。

### 4) External Source Discovery Engine

- 接收用户给定方向。
- 发现候选新闻源并生成推荐。
- 输出可审阅的源建议，进入来源管理流程。

### 5) Virtual Source Manager

- 为外部搜索结果分配“虚拟源”身份。
- 保证外部结果可追溯、可筛选、可治理。
- 避免污染原始采集源语义。

### 6) Quality & Governance

- 记录 AI 决策审计日志。
- 跟踪摘要质量、分类质量、源推荐采纳率。
- 为自动动作提供可配置的确认机制。

## Data Flow

### Flow A: AI 总结

1. 新闻入库后触发摘要生成任务或按需实时生成。
2. 摘要结果与新闻关联存储，并可用于搜索页聚合展示。
3. 定期任务聚合用户关注主题，输出简报。

### Flow B: AI 自动分类

1. 新闻通过现有 pipeline 进入待分类阶段。
2. 分类引擎输出主题标签与补充标签。
3. 标签写入新闻文档并同步检索索引。

### Flow C: 增强搜索

1. 用户输入自然语言问题。
2. 意图层拆解为“内部检索任务 + 外部补充任务”。
3. 外部结果通过虚拟源策略入库或临时缓存。
4. 融合排序后输出“结果列表 + AI 总结”。

### Flow D: 发现好源

1. 用户给定主题方向。
2. 发现引擎返回候选源与可信度。
3. 用户确认后写入 sources 管理域。

## Error Handling

系统按“可降级、可回滚、可审计”处理失败：

- 模型调用失败时降级到现有检索与规则链路，不阻断主功能。
- 外部搜索失败时只返回内部检索结果并标记补充失败原因。
- 虚拟源入库失败时启用临时缓存策略，保证当前会话可用。
- 分类或摘要质量低时保留原始内容，避免覆盖关键字段。
- 对自动化动作设置阈值与人工确认开关，降低误操作风险。

## Testing Strategy

### Functional Tests

- 摘要、分类、搜索增强、源发现四个能力域的用例覆盖。
- 用户隔离回归测试，确保跨用户数据不可见。
- 虚拟源链路测试，确保可入库、可筛选、可回溯。

### Quality Evaluation

- 摘要质量：可读性、事实一致性、压缩率。
- 分类质量：主题准确率、补充标签有效率。
- 搜索质量：相关性、覆盖率、用户点击与停留指标。
- 源发现质量：推荐接受率、后续有效产出率。

### Reliability Tests

- 外部接口超时/失败注入测试。
- ES 不可用场景下的降级回归。
- 定时任务高并发与重复执行保护测试。

## Open Questions

- 外部搜索结果默认“立即入库”还是“先临时缓存后确认入库”。
- 主题体系由固定字典驱动，还是允许用户级自定义。
- AI 自动补充标签是否允许直接影响排序权重。
- 摘要生成采用同步返回还是异步回填优先。
- 自动动作的权限边界如何分层（建议、半自动、全自动）。

---

本设计文档聚焦“先把能力边界和架构路径定清楚”，后续可基于该文档输出实现计划与里程碑。
