# News Hub æ¶æ„è®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

News Hub æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ–°é—»èšåˆå¹³å°ï¼Œæ”¯æŒå¤šæºé‡‡é›†ã€æ™ºèƒ½æœç´¢å’Œä¸ªæ€§åŒ–é˜…è¯»ä½“éªŒã€‚

### 1.1 æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **å¤šæºé‡‡é›†**: æ”¯æŒ RSS/API/HTML ä¸‰ç§é‡‡é›†æ–¹å¼
- ğŸ” **æ™ºèƒ½æœç´¢**: å…³é”®è¯ + å‘é‡æ··åˆæœç´¢ï¼Œæ”¯æŒè‡ªåŠ¨è¡¥å…¨
- ğŸ·ï¸ **è‡ªåŠ¨æ‰“æ ‡**: Jieba å…³é”®è¯æå– + ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™
- ğŸ‘¥ **å¤šç”¨æˆ·éš”ç¦»**: æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„æ•°æ®ç©ºé—´
- ğŸ–¼ï¸ **å›¾ç‰‡ä»£ç†**: è§£å†³é˜²ç›—é“¾é—®é¢˜
- ğŸ¨ **åŠ¨æ€å£çº¸**: Canvas åŠ¨ç”» + æ—¥å¤œåˆ‡æ¢

## 2. æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Vue 3)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Feed   â”‚ â”‚ Search  â”‚ â”‚ Sources â”‚ â”‚     Settings        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/JSON (JWT Auth)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (FastAPI)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    API Layer (v1)                        â”‚    â”‚
â”‚  â”‚   /auth  â”‚  /sources  â”‚  /news  â”‚  /search  â”‚  /media   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   Service Layer                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚Collector â”‚ â”‚ Pipeline â”‚ â”‚  Search  â”‚ â”‚ Tagging  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ Service  â”‚ â”‚ Service  â”‚ â”‚ Service  â”‚ â”‚ Service  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  Collector Strategies                    â”‚    â”‚
â”‚  â”‚      RSS (feedparser)  â”‚  API (httpx)  â”‚  HTML (Scrapy) â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       MongoDB           â”‚     â”‚     Elasticsearch       â”‚
â”‚  - users                â”‚     â”‚  - news_{user_id}       â”‚
â”‚  - sources              â”‚     â”‚    - IK Analyzer        â”‚
â”‚  - news                 â”‚     â”‚    - Dense Vector       â”‚
â”‚  - tag_rules            â”‚     â”‚    - Completion         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. æ•°æ®æ¨¡å‹

### 3.1 ç”¨æˆ· (User)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| _id | ObjectId | ç”¨æˆ·ID |
| username | string | ç”¨æˆ·å (å”¯ä¸€) |
| email | string | é‚®ç®± (å”¯ä¸€) |
| hashed_password | string | å¯†ç å“ˆå¸Œ |
| avatar_url | string? | å¤´åƒURL |
| settings | object | ç”¨æˆ·è®¾ç½® |
| is_active | boolean | è´¦æˆ·çŠ¶æ€ |
| created_at | datetime | åˆ›å»ºæ—¶é—´ |

### 3.2 æ•°æ®æº (Source)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| _id | ObjectId | æºID |
| user_id | string | æ‰€å±ç”¨æˆ· |
| name | string | æ˜¾ç¤ºåç§° |
| url | string | æºURL |
| source_type | enum | rss/api/html |
| parser_config | object | è§£æé…ç½® |
| status | enum | active/paused/error |
| last_fetched_at | datetime? | ä¸Šæ¬¡é‡‡é›†æ—¶é—´ |

### 3.3 æ–°é—»æ¡ç›® (News)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| _id | ObjectId | æ¡ç›®ID |
| user_id | string | æ‰€å±ç”¨æˆ· |
| source_id | string | æ¥æº |
| title | string | æ ‡é¢˜ |
| url | string | åŸæ–‡é“¾æ¥ |
| description | string? | æ‘˜è¦ |
| content | string? | æ­£æ–‡ |
| image_url | string? | å°é¢å›¾ |
| tags | string[] | æ ‡ç­¾ |
| published_at | datetime? | å‘å¸ƒæ—¶é—´ |
| is_read | boolean | å·²è¯»çŠ¶æ€ |
| is_starred | boolean | æ”¶è—çŠ¶æ€ |
| embedding | float[] | å‘é‡åµŒå…¥ |

### 3.4 æ ‡ç­¾è§„åˆ™ (TagRule)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| _id | ObjectId | è§„åˆ™ID |
| user_id | string | æ‰€å±ç”¨æˆ· |
| tag_name | string | æ ‡ç­¾å |
| keywords | string[] | åŒ¹é…å…³é”®è¯ |
| match_mode | enum | any/all |
| is_active | boolean | å¯ç”¨çŠ¶æ€ |

## 4. API è®¾è®¡

### 4.1 è®¤è¯ (/api/v1/auth)

| Method | Path | è¯´æ˜ |
|--------|------|------|
| POST | /register | ç”¨æˆ·æ³¨å†Œ |
| POST | /login | ç”¨æˆ·ç™»å½• |
| GET | /me | è·å–å½“å‰ç”¨æˆ· |
| PATCH | /me | æ›´æ–°ç”¨æˆ·èµ„æ–™ |

### 4.2 æ•°æ®æº (/api/v1/sources)

| Method | Path | è¯´æ˜ |
|--------|------|------|
| GET | / | è·å–æºåˆ—è¡¨ |
| POST | / | æ·»åŠ æ–°æº |
| GET | /{id} | è·å–æºè¯¦æƒ… |
| PATCH | /{id} | æ›´æ–°æºé…ç½® |
| DELETE | /{id} | åˆ é™¤æº |
| POST | /detect | è‡ªåŠ¨æ¢æµ‹æºç±»å‹ |
| POST | /{id}/refresh | æ‰‹åŠ¨åˆ·æ–° |

### 4.3 æ–°é—» (/api/v1/news)

| Method | Path | è¯´æ˜ |
|--------|------|------|
| GET | / | è·å–æ–°é—»æµ |
| GET | /{id} | è·å–è¯¦æƒ… |
| PATCH | /{id}/state | æ›´æ–°é˜…è¯»/æ”¶è—çŠ¶æ€ |

### 4.4 æœç´¢ (/api/v1/search)

| Method | Path | è¯´æ˜ |
|--------|------|------|
| GET | / | å…¨æ–‡æœç´¢ |
| GET | /suggest | æœç´¢è¡¥å…¨ |

### 4.5 åª’ä½“ (/api/v1/media)

| Method | Path | è¯´æ˜ |
|--------|------|------|
| GET | /proxy | å›¾ç‰‡ä»£ç† |

## 5. æœç´¢ç®—æ³•

### 5.1 æ··åˆæœç´¢æ’åº

```
final_score = text_score Ã— (freshness_decay + popularity_boost)
```

- **text_score**: multi_match æŸ¥è¯¢ï¼Œtitle^3 + description + tags^1.5
- **freshness_decay**: gauss å‡½æ•°ï¼Œ7å¤©åŠè¡°æœŸ
- **popularity_boost**: field_value_factorï¼Œå¯¹æ•°å¹³æ»‘çƒ­åº¦åˆ†

### 5.2 å‘é‡æœç´¢

- æ¨¡å‹: `shibing624/text2vec-base-chinese`
- ç»´åº¦: 768
- ç›¸ä¼¼åº¦: cosine
- æ··åˆæ–¹å¼: ä¸å…³é”®è¯æœç´¢ç»“æœåŠ æƒèåˆ

## 6. é‡‡é›†ç­–ç•¥

### 6.1 RSS ç­–ç•¥
- åº“: feedparser
- è‡ªåŠ¨è§£æ RSS/Atom æ ¼å¼

### 6.2 API ç­–ç•¥
- åº“: httpx
- é…ç½®: JMESPath å­—æ®µæ˜ å°„
- æ”¯æŒåˆ†é¡µ: offset/cursor

### 6.3 HTML ç­–ç•¥
- åº“: Scrapy + Playwright
- é…ç½®: CSS é€‰æ‹©å™¨
- æ”¯æŒ JavaScript æ¸²æŸ“

## 7. æ•°æ®éš”ç¦»

æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„:
- MongoDB æ–‡æ¡£ (é€šè¿‡ user_id å­—æ®µè¿‡æ»¤)
- Elasticsearch ç´¢å¼• (news_{user_id})

æ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨æ³¨å…¥ user_id è¿‡æ»¤æ¡ä»¶ã€‚

## 8. å®‰å…¨è®¾è®¡

- JWT Bearer Token è®¤è¯
- å¯†ç  bcrypt å“ˆå¸Œ
- CORS ç™½åå•
- è¯·æ±‚é¢‘ç‡é™åˆ¶ (TODO)
